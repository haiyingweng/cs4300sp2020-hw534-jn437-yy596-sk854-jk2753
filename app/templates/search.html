<html>

<head>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="/static/main.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<style>
    .cereal {
        cursor: pointer;
    }

    .details {
        position: absolute;
        width: 800px;
        height: 500px;
        margin: auto;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        border: 3px solid #fcc404;
        border-radius: 20px;
        padding: 20px;
        overflow: scroll;
    }

    .det-cereal-img img {
        height: auto;
        width: 300px;
        margin-top: 25px;
    }

    .row {
        display: flex;
        flex-direction: row;
    }

    .cereal-info {
        margin-left: 25px;
    }

    .x-btn {
        font-size: 30px;
        /* position: absolute;
        top: 5px;
        right: 20px; */
        position: fixed;
        top: 130px;
        right: 335px;
        color: gray;
        border: none;
        background: none !important;
        outline: none;
        fill: none;
    }
</style>

<body>
    <div id="lefttopcorner">
        <ul>
            <li><a href="/random">Random Cereal Generator</a></li>
            <li><a href="/top">Top 10</a></li>
            <li><a href="/compare">Compare Cereals</a></li>
        </ul>
    </div>

    {% if details %}
    {% set d = details[0] %}
    <div class="details" name={{query}}>
        <button class="x-btn"><span>&times;</span></button>

        <!-- TODO: figure out how to go back to page with query results -->
        <!-- <script>
            $(document).ready(function () {
                $(".x-btn").on("click", function (event) {
                    var query = document.getElementById("details").attr('name');
                    console.log(query);
                    $.ajax({
                        url: "/",
                        type: "get",
                        data: {
                            search: query
                        },
                        success: function (response) {
                            // console.log(response);
                            document.write(response);
                        },
                    });
                })
            });
        </script> -->

        <div class="row">
            <div class="cereal-info">
                <h3 class="cereal-name">{{d['name']}}</h3>
                <p><strong>Made by:</strong> {{d['manufacturer']}}</p>
                <p><strong>Rating:</strong> {{d['rating']}}</p>
                <p class="score" name="{{d['score']}}"><strong>Score:</strong> {{d['score']}}</p>
                <p>{{d['description']}}</p>

            </div>
            <div class="det-cereal-img">
                <img src="{{d['img_url']}}" height=200 width=200>
            </div>
        </div>
        <h4>Nutrition Facts</h4>
        <div class="nutrition-facts">
            <p><strong>Calories:</strong> {{d['calories']}}</p>
            <p><strong>Protein:</strong> {{d['protein']}}</p>
            <p><strong>Fat:</strong> {{d['fat']}}</p>
            <p><strong>Sodium:</strong> {{d['sodium']}}</p>
            <p><strong>Sugar:</strong> {{d['sugars']}}</p>
            <p><strong>Carbohydrate:</strong> {{d['carbo']}}</p>
            <p><strong>Fiber:</strong> {{d['fiber']}}</p>
            <p><strong>Potassium:</strong> {{d['potass']}}</p>
        </div>
    </div>

    {% else %}

    <div id="searchset">
        <form class="form-inline global-search" method="GET">
            <div id="mainpagelogo">
                <a href="/">
                    <img class="mlogo" src="/static/logo1.png" alt="Logo" width=532 height=132>
                </a>
            </div>

            <br><br>

            <div class="form-group">
                <input id="input" type="text" name="search" class="form-control"
                    placeholder="Keywords (e.g. marshmallows, chocolate, strawberry)">
            </div>
            <div id="filter">
                <div class="filtercat">
                    <h4>Nutrients</h4>
                    <ul>
                        <li>Calories
                            <ul>
                                <input type="checkbox" name="calcheckbox1" id="callow" value="callow" checked><label
                                    class="category-label" for="callow">Low</label>
                                <input type="checkbox" name="calcheckbox2" id="calmed" value="calmed" checked><label
                                    class="category-label" for="calmed">Medium</label>
                                <input type="checkbox" name="calcheckbox3" id="calhigh" value="calhigh" checked><label
                                    class="category-label" for="calhigh">High</label>
                            </ul>
                        </li>
                        <li>Protein
                            <ul>
                                <input type="checkbox" name="procheckbox1" id="prolow" value="prolow" checked><label
                                    class="category-label" for="prolow">Low</label>
                                <input type="checkbox" name="procheckbox2" id="promed" value="promed" checked><label
                                    class="category-label" for="promed">Medium</label>
                                <input type="checkbox" name="procheckbox3" id="prohigh" value="prohigh" checked><label
                                    class="category-label" for="prohigh">High</label>
                            </ul>
                        </li>
                        <li>Fat
                            <ul>
                                <input type="checkbox" name="fatcheckbox1" id="fatlow" value="fatlow" checked><label
                                    class="category-label" for="fatlow">Low</label>
                                <input type="checkbox" name="fatcheckbox2" id="fatmed" value="fatmed" checked><label
                                    class="category-label" for="fatmed">Medium</label>
                                <input type="checkbox" name="fatcheckbox3" id="fathigh" value="fathigh" checked><label
                                    class="category-label" for="fathigh">High</label>
                            </ul>
                        </li>
                        <li>Sodium
                            <ul>
                                <input type="checkbox" name="sodcheckbox1" id="sodlow" value="sodlow" checked><label
                                    class="category-label" for="sodlow">Low</label>
                                <input type="checkbox" name="sodcheckbox2" id="sodmed" value="sodmed" checked><label
                                    class="category-label" for="sodmed">Medium</label>
                                <input type="checkbox" name="sodcheckbox3" id="sodhigh" value="sodhigh" checked><label
                                    class="category-label" for="sodhigh">High</label>
                            </ul>
                        </li>
                        <li>Fiber
                            <ul>
                                <input type="checkbox" name="fibcheckbox1" id="fiblow" value="fiblow" checked><label
                                    class="category-label" for="fiblow">Low</label>
                                <input type="checkbox" name="fibcheckbox2" id="fibmed" value="fibmed" checked><label
                                    class="category-label" for="fibmed">Medium</label>
                                <input type="checkbox" name="fibcheckbox3" id="fibhigh" value="fibhigh" checked><label
                                    class="category-label" for="fibhigh">High</label>
                            </ul>
                        </li>
                        <li>Carbohydrate
                            <ul>
                                <input type="checkbox" name="carbcheckbox1" id="carblow" value="carblow" checked><label
                                    class="category-label" for="carblow">Low</label>
                                <input type="checkbox" name="carbcheckbox2" id="carbmed" value="carbmed" checked><label
                                    class="category-label" for="carbmed">Medium</label>
                                <input type="checkbox" name="carbcheckbox3" id="carbhigh" value="carbhigh"
                                    checked><label class="category-label" for="carbhigh">High</label>
                            </ul>
                        </li>
                        <li>Sugar
                            <ul>
                                <input type="checkbox" name="sugcheckbox1" id="suglow" value="suglow" checked><label
                                    class="category-label" for="suglow">Low</label>
                                <input type="checkbox" name="sugcheckbox2" id="sugmed" value="sugmed" checked><label
                                    class="category-label" for="sugmed">Medium</label>
                                <input type="checkbox" name="sugcheckbox3" id="sughigh" value="sughigh" checked><label
                                    class="category-label" for="sughigh">High</label>
                            </ul>
                        </li>
                        <li>Potassium
                            <ul>
                                <input type="checkbox" name="potcheckbox1" id="potlow" value="potlow" checked><label
                                    class="category-label" for="potlow">Low</label>
                                <input type="checkbox" name="potcheckbox2" id="potmed" value="potmed" checked><label
                                    class="category-label" for="potmed">Medium</label>
                                <input type="checkbox" name="potcheckbox3" id="pothigh" value="pothigh" checked><label
                                    class="category-label" for="pothigh">High</label>
                            </ul>
                        </li>

                    </ul>
                    <h4>Dietary</h4>
                    <input type="checkbox" name="vegcheckbox" id="Vegan" value="Vegan"><label class="category-label"
                        for="Vegan">Vegan</label>
                    <input type="checkbox" name="PFcheckbox" id="PF" value="PF"><label class="category-label"
                        for="PF">Peanut Free</label>
                    <input type="checkbox" name="GFcheckbox" id="GF" value="GF"><label class="category-label"
                        for="GF">Gluten Free</label>
                </div>
            </div>
            <script>
                function showhideform() {
                    var x = document.getElementById('filter');
                    if (x.style.display === "none") {
                        x.style.display = "inline-block";
                    } else {
                        x.style.display = "none";
                    }
                }
            </script>
            <button type="button" id="filterbutton" onclick="showhideform();">
            </button>
            <button type="submit" class="btn btn-info"> Go! </button>

        </form>

        <div class="search-result">
            {% if query %}
            <h3 class="output-message">Your keyword(s): {{query}}</h3>
            <p id="query" hidden>{{query}}</p>
            {% endif %}
            <br>
            {% if data %}
            {% for d in data %}
            <div class="cereal" name="{{d['tcin']}}">
                <div class="cereal-img">
                    <img src="{{d['img_url']}}" alt="{{d['name']}}" height=200 width=200>
                </div>
                <div class="cereal-info">
                    <h3 class="cereal-name">{{d['name']}}</h3>
                    <p><strong>Made by:</strong> {{d['manufacturer']}}</p>
                    <p><strong>Rating:</strong> {{d['rating']}}</p>
                    <p class="score" name="{{d['score']}}"><strong>Score:</strong> {{d['score']}}</p>
                    <p>{{d['description']}}</p>
                    <h4>Nutrition Facts</h4>
                    <div class="nutrition-facts">
                        <p><strong>Calories:</strong> {{d['calories']}}</p>
                        <p><strong>Protein:</strong> {{d['protein']}}</p>
                        <p><strong>Fat:</strong> {{d['fat']}}</p>
                        <p><strong>Sodium:</strong> {{d['sodium']}}</p>
                        <p><strong>Sugar:</strong> {{d['sugars']}}</p>
                        <p><strong>Carbohydrate:</strong> {{d['carbo']}}</p>
                        <p><strong>Fiber:</strong> {{d['fiber']}}</p>
                        <p><strong>Potassium:</strong> {{d['potass']}}</p>
                    </div>
                </div>
            </div>
            <script>
                $(document).ready(function () {
                    var x = document.getElementById('filter');
                    $(".cereal").on("click", function (event) {
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        var tcin = $(this).attr('name');
                        var name = $(this).find(".cereal-name").text();
                        var query = document.getElementById("query").textContent;
                        var score = $(this).find(".score").attr('name');
                        console.log(score);
                        $.ajax({
                            url: "/cerealname",
                            type: "get",
                            data: {
                                query: query,
                                cereal_name: name,
                                tcin: tcin,
                                score: score
                            },
                            success: function (response) {
                                // console.log(response);
                                // TODO: fix error - A parser-blocking, cross site (i.e. different eTLD+1) script, https://code.jquery.com/jquery-3.5.1.min.js, is invoked via document.write.
                                document.write(response);
                            },
                        });
                    })
                });
            </script>
            {% endfor %}
            {% else %}
            {% if query %}
            <p class="no-result-label">No result found</p>
            {% endif %}
            {% endif %}
        </div>

    </div>
    {% endif %}

    <div class="sfooter">
        <p>Project Name: Cerealizer </p>
        <p>Student Name: hw534, jn437, yy596, sk854, jk2753</p>
    </div>

</body>

</html>